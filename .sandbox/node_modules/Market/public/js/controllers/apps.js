// Apps Controllers
//==============
angular.module('AppsModule', [])
.controller('AppsIndexCtrl', ['$scope', '$http',
  function ($scope, $http) {
   $http.get('/apps?api=true').
   success(function(data, status, headers, config) {
    $scope.apps = data || [];
    console.log(status);
  }).
   error(function(data, status, headers, config) {
    $scope.apps = null;
    console.log("Could not fetch apps");
  });
 }])
.controller('AppsShowCtrl', ['$scope', '$routeParams', '$http', '$location',
  function($scope, $routeParams, $http, $location) {
    var name = $routeParams.name;
    $http.get('/apps/' + name).
    success(function(data, status, headers, config) {
      $scope.app = data;
    }).
    error(function(data, status, headers, config) {
      console.log("Could not fetch app");
    });  
    $scope.install = function () {
      $scope.pc = 25;
      $http.get('/download/' + name).
      success(function(data, status, headers, config) {
        $scope.pc = 90;
        $location.path('/');
      }).
      error(function(data, status, headers, config) {
        $scope.pc = 90;
        alert(status + " (server error): " + data);
      })
      .then(function() {
        $scope.pc = false;
      });
    };
  }]);